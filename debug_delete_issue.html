<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ é™¤é—®é¢˜è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .file-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            margin: 5px 0;
            border-radius: 4px;
        }
        .file-name {
            flex: 1;
            margin-right: 10px;
        }
        .delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>åˆ é™¤é—®é¢˜è°ƒè¯•</h1>
    
    <div id="fileList">
        <div class="file-item" id="file-1">
            <span class="file-name">æµ‹è¯•æ–‡ä»¶ 1.txt</span>
            <button class="delete-btn" onclick="deleteFile(1)">ğŸ—‘ï¸ åˆ é™¤</button>
        </div>
        <div class="file-item" id="file-2">
            <span class="file-name">æµ‹è¯•æ–‡ä»¶ 2.txt</span>
            <button class="delete-btn" onclick="deleteFile(2)">ğŸ—‘ï¸ åˆ é™¤</button>
        </div>
        <div class="file-item" id="file-3">
            <span class="file-name">æµ‹è¯•æ–‡ä»¶ 3.txt</span>
            <button class="delete-btn" onclick="deleteFile(3)">ğŸ—‘ï¸ åˆ é™¤</button>
        </div>
    </div>

    <div class="log" id="log"></div>

    <script>
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // æ¨¡æ‹Ÿ Vue çš„å“åº”å¼è¡Œä¸º
        let files = [
            { id: 1, name: 'æµ‹è¯•æ–‡ä»¶ 1.txt' },
            { id: 2, name: 'æµ‹è¯•æ–‡ä»¶ 2.txt' },
            { id: 3, name: 'æµ‹è¯•æ–‡ä»¶ 3.txt' }
        ];

        // æ¨¡æ‹Ÿ store çš„åˆ é™¤æ–¹æ³•
        async function storeDeleteFile(fileId) {
            log(`store.deleteFile è¢«è°ƒç”¨ï¼Œæ–‡ä»¶ID: ${fileId}`);
            
            try {
                log('å‘é€åˆ é™¤è¯·æ±‚åˆ°åç«¯...');
                
                // æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 100));
                
                log('åç«¯åˆ é™¤æˆåŠŸï¼Œæ›´æ–°æœ¬åœ°çŠ¶æ€...');
                
                // ç«‹å³æ›´æ–°æœ¬åœ°çŠ¶æ€ï¼ˆè¿™é‡Œæ˜¯é—®é¢˜æ‰€åœ¨ï¼‰
                files = files.filter(file => file.id !== fileId);
                updateUI();
                
                log('æœ¬åœ°çŠ¶æ€æ›´æ–°å®Œæˆ');
                
                return { success: true, message: 'æ–‡ä»¶åˆ é™¤æˆåŠŸ' };
            } catch (error) {
                log(`åˆ é™¤å¤±è´¥: ${error.message}`);
                return { success: false, error: error.message };
            }
        }

        // æ›´æ–° UI
        function updateUI() {
            log('æ›´æ–° UI...');
            files.forEach(file => {
                const element = document.getElementById(`file-${file.id}`);
                if (element) {
                    element.style.display = 'block';
                }
            });
            
            // éšè—å·²åˆ é™¤çš„æ–‡ä»¶
            for (let i = 1; i <= 3; i++) {
                if (!files.find(f => f.id === i)) {
                    const element = document.getElementById(`file-${i}`);
                    if (element) {
                        element.style.display = 'none';
                        log(`æ–‡ä»¶ ${i} ä» UI ä¸­ç§»é™¤`);
                    }
                }
            }
        }

        // åˆ é™¤æ–‡ä»¶å‡½æ•°ï¼ˆæ¨¡æ‹Ÿ FileDisplay.vue ä¸­çš„é€»è¾‘ï¼‰
        async function deleteFile(fileId) {
            log(`deleteFile å‡½æ•°è¢«è°ƒç”¨ï¼Œæ–‡ä»¶ID: ${fileId}`);
            
            log('æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†...');
            const confirmed = confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ');
            log(`ç”¨æˆ·ç¡®è®¤ç»“æœ: ${confirmed}`);
            
            if (!confirmed) {
                log('ç”¨æˆ·å–æ¶ˆåˆ é™¤ï¼Œå‡½æ•°è¿”å›');
                return;
            }
            
            log('ç”¨æˆ·ç¡®è®¤åˆ é™¤ï¼Œå¼€å§‹è°ƒç”¨ store æ–¹æ³•');
            const result = await storeDeleteFile(fileId);
            log(`store åˆ é™¤ç»“æœ: ${JSON.stringify(result)}`);
            
            if (!result.success) {
                alert(`åˆ é™¤å¤±è´¥: ${result.error}`);
            }
        }

        // æµ‹è¯•ä¸åŒçš„åˆ é™¤æ–¹å¼
        async function testImmediateDelete(fileId) {
            log(`\n=== æµ‹è¯•ç«‹å³åˆ é™¤ï¼ˆé—®é¢˜ç‰ˆæœ¬ï¼‰===`);
            
            log(`å‡†å¤‡åˆ é™¤æ–‡ä»¶ ${fileId}`);
            
            // æ¨¡æ‹Ÿé—®é¢˜ï¼šåœ¨ç¡®è®¤å¯¹è¯æ¡†æ˜¾ç¤ºçš„åŒæ—¶ç«‹å³æ›´æ–° UI
            setTimeout(() => {
                log('ç«‹å³æ›´æ–° UIï¼ˆæ¨¡æ‹Ÿé—®é¢˜ï¼‰');
                files = files.filter(file => file.id !== fileId);
                updateUI();
            }, 10); // å¾ˆçŸ­çš„å»¶è¿Ÿï¼Œæ¨¡æ‹Ÿå¼‚æ­¥æ›´æ–°
            
            const confirmed = confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿï¼ˆUI å·²ç»æ›´æ–°ï¼‰');
            log(`ç”¨æˆ·ç¡®è®¤ç»“æœ: ${confirmed}`);
            
            if (!confirmed) {
                log('ç”¨æˆ·å–æ¶ˆäº†ï¼Œä½†æ–‡ä»¶å·²ç»ä» UI ä¸­æ¶ˆå¤±äº†ï¼');
                // è¿™é‡Œåº”è¯¥æ¢å¤æ–‡ä»¶ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å¾ˆéš¾åšåˆ°
            }
        }

        // åœ¨é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            log('ç‚¹å‡»åˆ é™¤æŒ‰é’®æµ‹è¯•æ­£å¸¸æµç¨‹');
            log('æˆ–è€…åœ¨æ§åˆ¶å°è¿è¡Œ testImmediateDelete(1) æµ‹è¯•é—®é¢˜åœºæ™¯');
        };
    </script>
</body>
</html>