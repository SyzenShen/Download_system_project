<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶å¤¹å¯¼èˆªåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .feature-list {
            list-style-type: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "âœ“ ";
            color: #28a745;
            font-weight: bold;
        }
        .test-steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .test-steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .test-steps li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>æ–‡ä»¶å¤¹å¯¼èˆªåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ¯ æ–°åŠŸèƒ½æ¦‚è§ˆ</h2>
        <ul class="feature-list">
            <li>æ–‡ä»¶å¤¹å•å‡»è¿›å…¥ï¼ˆåŸæ¥æ˜¯åŒå‡»ï¼‰</li>
            <li>è¿”å›ä¸Šä¸€çº§ç›®å½•æŒ‰é’®</li>
            <li>é¢åŒ…å±‘å¯¼èˆªæ˜¾ç¤ºå½“å‰è·¯å¾„</li>
            <li>ç‚¹å‡»é¢åŒ…å±‘å¯å¿«é€Ÿè·³è½¬</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>ğŸ§ª æµ‹è¯•æ­¥éª¤</h2>
        <div class="test-steps">
            <h3>1. åŸºç¡€å¯¼èˆªæµ‹è¯•</h3>
            <ol>
                <li>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰“å¼€æ–‡ä»¶ç®¡ç†é¡µé¢</li>
                <li>ç¡®è®¤é¡µé¢æ˜¾ç¤ºæ–‡ä»¶å¤¹åˆ—è¡¨</li>
                <li><strong>å•å‡»</strong>ä»»æ„æ–‡ä»¶å¤¹ï¼ˆä¸æ˜¯åŒå‡»ï¼‰</li>
                <li>éªŒè¯æ˜¯å¦æˆåŠŸè¿›å…¥æ–‡ä»¶å¤¹</li>
            </ol>
        </div>
        
        <div class="test-steps">
            <h3>2. è¿”å›æŒ‰é’®æµ‹è¯•</h3>
            <ol>
                <li>è¿›å…¥ä»»æ„æ–‡ä»¶å¤¹å</li>
                <li>æŸ¥çœ‹å¯¼èˆªæ å·¦ä¾§æ˜¯å¦å‡ºç°"â† è¿”å›"æŒ‰é’®</li>
                <li>ç‚¹å‡»è¿”å›æŒ‰é’®</li>
                <li>éªŒè¯æ˜¯å¦è¿”å›åˆ°ä¸Šä¸€çº§ç›®å½•</li>
            </ol>
        </div>
        
        <div class="test-steps">
            <h3>3. é¢åŒ…å±‘å¯¼èˆªæµ‹è¯•</h3>
            <ol>
                <li>è¿›å…¥å¤šå±‚åµŒå¥—çš„æ–‡ä»¶å¤¹</li>
                <li>è§‚å¯Ÿé¢åŒ…å±‘å¯¼èˆªï¼šğŸ  å…¨éƒ¨æ–‡ä»¶ > æ–‡ä»¶å¤¹1 > æ–‡ä»¶å¤¹2</li>
                <li>ç‚¹å‡»é¢åŒ…å±‘ä¸­çš„ä»»æ„å±‚çº§</li>
                <li>éªŒè¯æ˜¯å¦èƒ½å¿«é€Ÿè·³è½¬åˆ°å¯¹åº”ç›®å½•</li>
            </ol>
        </div>
        
        <div class="test-steps">
            <h3>4. åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¤¹</h3>
            <ol>
                <li>ç‚¹å‡»"æ–°å»ºæ–‡ä»¶å¤¹"æŒ‰é’®</li>
                <li>åˆ›å»ºå‡ ä¸ªåµŒå¥—çš„æ–‡ä»¶å¤¹ç”¨äºæµ‹è¯•</li>
                <li>æµ‹è¯•åœ¨ä¸åŒå±‚çº§é—´çš„å¯¼èˆª</li>
            </ol>
        </div>
        
        <button class="test-button" onclick="openFilesPage()">ğŸš€ æ‰“å¼€æ–‡ä»¶ç®¡ç†é¡µé¢å¼€å§‹æµ‹è¯•</button>
        <button class="test-button" onclick="createTestFolders()">ğŸ“ åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¤¹ç»“æ„</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•</h2>
        <div id="checklist">
            <label><input type="checkbox"> æ–‡ä»¶å¤¹å¯ä»¥å•å‡»è¿›å…¥</label><br>
            <label><input type="checkbox"> è¿›å…¥æ–‡ä»¶å¤¹åæ˜¾ç¤ºè¿”å›æŒ‰é’®</label><br>
            <label><input type="checkbox"> è¿”å›æŒ‰é’®åŠŸèƒ½æ­£å¸¸</label><br>
            <label><input type="checkbox"> é¢åŒ…å±‘å¯¼èˆªæ˜¾ç¤ºæ­£ç¡®è·¯å¾„</label><br>
            <label><input type="checkbox"> é¢åŒ…å±‘å¯¼èˆªå¯ç‚¹å‡»è·³è½¬</label><br>
            <label><input type="checkbox"> åœ¨æ ¹ç›®å½•æ—¶ä¸æ˜¾ç¤ºè¿”å›æŒ‰é’®</label><br>
            <label><input type="checkbox"> åˆ é™¤æŒ‰é’®ä¸ä¼šè§¦å‘æ–‡ä»¶å¤¹è¿›å…¥</label><br>
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”§ APIæµ‹è¯•å·¥å…·</h2>
        <button class="test-button" onclick="testAPI()">æµ‹è¯•APIè¿æ¥</button>
        <button class="test-button" onclick="checkAuth()">æ£€æŸ¥ç™»å½•çŠ¶æ€</button>
        <div id="api-status"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8001';
        
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function openFilesPage() {
            window.open('http://localhost:5173/files', '_blank');
        }
        
        async function createTestFolders() {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('è¯·å…ˆç™»å½•ï¼');
                return;
            }
            
            try {
                // åˆ›å»ºä¸»æµ‹è¯•æ–‡ä»¶å¤¹
                const mainFolder = await createFolder('å¯¼èˆªæµ‹è¯•æ–‡ä»¶å¤¹');
                if (!mainFolder) return;
                
                // åˆ›å»ºå­æ–‡ä»¶å¤¹
                const subFolder1 = await createFolder('å­æ–‡ä»¶å¤¹1', mainFolder.id);
                const subFolder2 = await createFolder('å­æ–‡ä»¶å¤¹2', mainFolder.id);
                
                if (subFolder1) {
                    // åœ¨å­æ–‡ä»¶å¤¹1ä¸­åˆ›å»ºæ›´æ·±å±‚çš„æ–‡ä»¶å¤¹
                    await createFolder('æ·±å±‚æ–‡ä»¶å¤¹', subFolder1.id);
                }
                
                alert('æµ‹è¯•æ–‡ä»¶å¤¹ç»“æ„åˆ›å»ºå®Œæˆï¼\\nè¯·åˆ·æ–°é¡µé¢æŸ¥çœ‹ã€‚');
                
            } catch (error) {
                alert('åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¤¹å¤±è´¥ï¼š' + error.message);
            }
        }
        
        async function createFolder(name, parentId = null) {
            const token = localStorage.getItem('token');
            const data = { name };
            if (parentId) {
                data.parent_folder = parentId;
            }
            
            const response = await fetch(`${API_BASE}/api/files/folders/`, {
                method: 'POST',
                headers: {
                    'Authorization': `Token ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                return await response.json();
            } else {
                throw new Error(`åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥: ${response.status}`);
            }
        }
        
        async function testAPI() {
            const token = localStorage.getItem('token');
            if (!token) {
                showStatus('api-status', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/files/`, {
                    headers: {
                        'Authorization': `Token ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showStatus('api-status', `
                        <strong>APIè¿æ¥æ­£å¸¸</strong><br>
                        æ–‡ä»¶æ•°é‡ï¼š${data.files?.length || 0}<br>
                        æ–‡ä»¶å¤¹æ•°é‡ï¼š${data.folders?.length || 0}
                    `, 'success');
                } else {
                    showStatus('api-status', `APIè°ƒç”¨å¤±è´¥ï¼š${response.status}`, 'error');
                }
            } catch (error) {
                showStatus('api-status', `ç½‘ç»œé”™è¯¯ï¼š${error.message}`, 'error');
            }
        }
        
        function checkAuth() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                try {
                    const userData = JSON.parse(user);
                    showStatus('api-status', `
                        <strong>å·²ç™»å½•</strong><br>
                        ç”¨æˆ·ï¼š${userData.username}<br>
                        Tokenï¼š${token.substring(0, 20)}...
                    `, 'success');
                } catch (e) {
                    showStatus('api-status', 'ç”¨æˆ·æ•°æ®è§£æå¤±è´¥', 'error');
                }
            } else {
                showStatus('api-status', 'æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•', 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.onload = function() {
            checkAuth();
        };
    </script>
</body>
</html>